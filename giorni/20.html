<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéÑ Giorno 20 ‚Äì Attento! Riprova!</title>

<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Ubuntu',sans-serif;
  background:#7b0412;
  color:white;
  text-align:center;
}

h1{
  color:#ffd700;
  margin:10px 0 4px;
  font-size:1.4em;
}

#counter{
  margin:6px 0 10px;
  font-weight:bold;
  color:#ffd700;
}

/* CONTENITORE GIOCO */
#game{
  position:relative;
  max-width:380px;
  margin:0 auto;
  touch-action: manipulation;
}

#game img{
  width:100%;
  display:block;
  border-radius:12px;
}

/* OGGETTI DA TROVARE */
.item{
  position:absolute;
  border-radius:50%;
}

/* TRAPPOLA INVISIBILE */
#grinchTrap{
  position:absolute;
  top:32%;
  left:55%;
  width:60px;
  height:60px;
}

/* OVERLAY GENERICO */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:20;
}

.overlayBox{
  background:white;
  color:#7b0412;
  padding:20px;
  border-radius:16px;
  max-width:300px;
  text-align:center;
}

.overlayBox img{
  width:100%;
  border-radius:12px;
}

.overlayBox button{
  margin-top:12px;
  padding:10px 22px;
  border:none;
  border-radius:20px;
  background:#7b0412;
  color:white;
  font-weight:bold;
}

#overlayError{
  display:none;
}

#msg{
  margin:10px;
  color:#00ff99;
  font-size:1.1em;
}

.btn-back{
  display:inline-block;
  margin:12px auto;
  padding:12px 28px;
  background:#f3e4e4;
  color:black;
  border-radius:30px;
  font-weight:bold;
  text-decoration:none;
}

/* BLOCCO DOPPIO TAP */
html, body, #game{
  touch-action: manipulation;
}
</style>
</head>

<body>

<!-- OVERLAY INIZIALE -->
<div id="startOverlay" class="overlay">
  <div class="overlayBox">
    <h2>üéÑ Giorno 20</h2>
    <p>
      üîç Trova tutti gli oggetti nascosti nell‚Äôimmagine.<br><br>
      ü§è Puoi ingrandire con due dita.<br><br>
      ‚ö†Ô∏è Attento! Se tocchi il punto sbagliato,<br>
      dovrai <b>riprovarci</b>.
    </p>
    <button onclick="startGame()">Inizia</button>
  </div>
</div>

<h1>üéÑ Giorno 20</h1>
<div id="counter">üîç Oggetti trovati: 0 / 10</div>

<div id="game">
  <!-- IMMAGINE PRINCIPALE -->
  <img src="img/disegno.jpg" alt="Disegno Natale">

  <!-- OGGETTI DA TROVARE (HOTSPOT INVISIBILI) -->
  <div class="item" style="top:18%; left:12%; width:30px; height:30px;"></div>
  <div class="item" style="top:28%; left:62%; width:28px; height:28px;"></div>
  <div class="item" style="top:45%; left:70%; width:30px; height:30px;"></div>
  <div class="item" style="top:52%; left:22%; width:28px; height:28px;"></div>
  <div class="item" style="top:60%; left:48%; width:30px; height:30px;"></div>
  <div class="item" style="top:67%; left:15%; width:28px; height:28px;"></div>
  <div class="item" style="top:72%; left:65%; width:30px; height:30px;"></div>
  <div class="item" style="top:38%; left:40%; width:26px; height:26px;"></div>
  <div class="item" style="top:80%; left:35%; width:28px; height:28px;"></div>
  <div class="item" style="top:22%; left:80%; width:26px; height:26px;"></div>

  <!-- TRAPPOLA INVISIBILE -->
  <div id="grinchTrap"></div>
</div>

<div id="msg"></div>

<a href="../calendario.html" class="btn-back">‚Üê Calendario</a>

<!-- OVERLAY ERRORE -->
<div id="overlayError" class="overlay">
  <div class="overlayBox">
    <img src="img/cami.png" alt="Attento">
    <p>
      <b>ATTENTO!</b><br>
      Il Grinch sta rubando gli oggetti‚Ä¶<br>
      <b>Riprova!</b>
    </p>
    <button onclick="restart()">Riprova</button>
  </div>
</div>

<script>
/* BLOCCO DOPPIO TAP */
let lastTap = 0;
document.addEventListener("touchend", e=>{
  const now = Date.now();
  if(now - lastTap < 300) e.preventDefault();
  lastTap = now;
},{passive:false});

/* AUDIO UH-OH */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playUhOh(){
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.type = "sawtooth";
  osc.frequency.setValueAtTime(220, audioCtx.currentTime);
  osc.frequency.exponentialRampToValueAtTime(110, audioCtx.currentTime + 0.4);
  gain.gain.setValueAtTime(0.25, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.4);
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime + 0.4);
}

/* LOGICA OGGETTI */
const items = document.querySelectorAll(".item");
const counter = document.getElementById("counter");
const totale = items.length;
let trovati = 0;

counter.textContent = `üîç Oggetti trovati: ${trovati} / ${totale}`;

items.forEach(i=>{
  i.dataset.found="false";
  i.addEventListener("click",()=>{
    if(i.dataset.found==="true") return;
    i.dataset.found="true";
    trovati++;
    i.style.background="rgba(0,255,0,0.35)";
    counter.textContent = `üîç Oggetti trovati: ${trovati} / ${totale}`;

    if(trovati === totale){
      document.getElementById("msg").textContent =
        "üéâ Bravo! Hai trovato tutti gli oggetti!";
    }
  });
});

/* TRAPPOLA */
document.getElementById("grinchTrap").addEventListener("click",()=>{
  playUhOh();
  document.getElementById("overlayError").style.display="flex";
});

/* START */
function startGame(){
  document.getElementById("startOverlay").style.display="none";
}

/* RESET */
function restart(){
  trovati = 0;
  counter.textContent = `üîç Oggetti trovati: 0 / ${totale}`;
  items.forEach(i=>{
    i.dataset.found="false";
    i.style.background="transparent";
  });
  document.getElementById("msg").textContent="";
  document.getElementById("overlayError").style.display="none";
}
</script>

</body>
</html>
