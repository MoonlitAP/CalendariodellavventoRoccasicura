<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ„ Giorno 20 â€“ Trova gli oggetti</title>

<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Ubuntu',sans-serif;
  background:#7b0412;
  color:white;
  text-align:center;
}

h1{
  color:#ffd700;
  margin:10px 0 4px;
  font-size:1.4em;
}

#counter{
  margin:6px 0 6px;
  font-weight:bold;
  color:#ffd700;
}

#list{
  font-size:0.9em;
  margin-bottom:10px;
  opacity:0.95;
}

/* CONTENITORE GIOCO */
#game{
  position:relative;
  max-width:380px;
  margin:0 auto;
  touch-action: manipulation;
}

#game img{
  width:100%;
  display:block;
  border-radius:12px;
  pointer-events:none;
}

/* HOTSPOT */
.item, #grinchTrap{
  position:absolute;
  width:44px;
  height:44px;
  border-radius:50%;
  transform: translate(-50%, -50%);
}

.item.found{
  background: rgba(0,255,0,0.18);
  border: 2px solid #00ff99;
  box-shadow: 0 0 7px rgba(0,255,153,0.95);
}

/* TRAPPOLA */
#grinchTrap{
  width:70px;
  height:70px;
  border-radius:18px;
  background:transparent;
}

/* OVERLAY */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:20;
}

.overlayBox{
  background:white;
  color:#7b0412;
  padding:20px;
  border-radius:16px;
  max-width:320px;
  text-align:center;
}

.overlayBox img{
  width:100%;
  border-radius:12px;
}

.overlayBox button{
  margin-top:12px;
  padding:10px 22px;
  border:none;
  border-radius:20px;
  background:#7b0412;
  color:white;
  font-weight:bold;
}

.hidden{
  display:none !important;
}

#msg{
  margin:10px;
  color:#00ff99;
  font-size:1.1em;
}

.btn-back{
  display:inline-block;
  margin:12px auto 18px;
  padding:12px 28px;
  background:#f3e4e4;
  color:black;
  border-radius:30px;
  font-weight:bold;
  text-decoration:none;
}

html, body, #game{
  touch-action: manipulation;
}
</style>
</head>

<body>

<!-- OVERLAY INIZIALE -->
<div id="startOverlay" class="overlay">
  <div class="overlayBox">
    <h2>ğŸ„ Giorno 20</h2>
    <p>
      ğŸ” Trova tutti gli oggetti nascosti nellâ€™immagine.<br><br>
      ğŸ¤ Puoi ingrandire con due dita.<br><br>
      âš ï¸ Attento! Se tocchi il punto sbagliato,<br>
      dovrai <b>riprovarci</b>.
    </p>
    <button id="startBtn">Inizia</button>
  </div>
</div>

<h1>ğŸ„ Giorno 20</h1>
<div id="counter">ğŸ” Oggetti trovati: 0 / 10</div>
<div id="list">ğŸ›ï¸ ğŸ¦ â¤ï¸ ğŸ ğŸº ğŸ§¦ ğŸª ğŸ’¡ â­ ğŸ•¯ï¸</div>

<div id="game">
  <img src="img/disegno.jpg" alt="Disegno Natale">

  <!-- HOTSPOT DEFINITIVI -->
  <div class="item" data-name="campanella" style="top:87%; left:55%;"></div>
  <div class="item" data-name="uccellino"  style="top:63%; left:14%;"></div>
  <div class="item" data-name="cuore"       style="top:52%; left:33%;"></div>
  <div class="item" data-name="pallina"     style="top:49%; left:45%;"></div>
  <div class="item" data-name="trombetta"   style="top:21%; left:52%;"></div>
  <div class="item" data-name="calza"       style="top:36%; left:15%;"></div>
  <div class="item" data-name="biscotto"    style="top:43%; left:86%;"></div>
  <div class="item" data-name="lampadina"   style="top:22%; left:92%;"></div>
  <div class="item" data-name="stella"      style="top:24%; left:86%;"></div>
  <div class="item" data-name="candela"     style="top:20%; left:96%;"></div>

  <!-- TRAPPOLA -->
  <div id="grinchTrap" style="top:41%; left:38%;"></div>
</div>

<div id="msg"></div>

<a href="../calendario.html" class="btn-back">â† Calendario</a>

<!-- OVERLAY ERRORE -->
<div id="overlayError" class="overlay hidden">
  <div class="overlayBox">
    <img src="img/cami.png" alt="Attento">
    <p>
      <b>ATTENTO!</b><br>
      Il Grinch sta rubando gli oggettiâ€¦<br>
      <b>Riprova!</b>
    </p>
    <button id="retryBtn">Riprova</button>
  </div>
</div>

<script>
/* BLOCCO DOPPIO TAP */
let lastTap = 0;
document.addEventListener("touchend", e=>{
  const now = Date.now();
  if(now - lastTap < 300) e.preventDefault();
  lastTap = now;
},{passive:false});

/* AUDIO */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playUhOh(){
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.type = "sawtooth";
  osc.frequency.setValueAtTime(220, audioCtx.currentTime);
  osc.frequency.exponentialRampToValueAtTime(110, audioCtx.currentTime + 0.4);
  gain.gain.setValueAtTime(0.25, audioCtx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.4);
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime + 0.4);
}

function bindTap(el, fn){
  el.addEventListener("touchstart", e=>{
    e.preventDefault();
    fn();
  },{passive:false});
  el.addEventListener("click", e=>{
    e.preventDefault();
    fn();
  });
}

const startOverlay = document.getElementById("startOverlay");
const overlayError = document.getElementById("overlayError");
const counter = document.getElementById("counter");
const msg = document.getElementById("msg");
const items = document.querySelectorAll(".item");
const totale = items.length;

let trovati = 0;

function startGame(){
  startOverlay.classList.add("hidden");
}

function showError(){
  playUhOh();
  overlayError.classList.remove("hidden");
}

function restart(){
  trovati = 0;
  counter.textContent = `ğŸ” Oggetti trovati: 0 / ${totale}`;
  msg.textContent = "";
  items.forEach(i=>{
    i.dataset.found = "false";
    i.classList.remove("found");
  });
  overlayError.classList.add("hidden");
}

bindTap(document.getElementById("startBtn"), startGame);
bindTap(document.getElementById("retryBtn"), restart);
bindTap(document.getElementById("grinchTrap"), showError);

items.forEach(i=>{
  i.dataset.found = "false";
  bindTap(i, ()=>{
    if(i.dataset.found === "true") return;
    i.dataset.found = "true";
    i.classList.add("found");
    trovati++;
    counter.textContent = `ğŸ” Oggetti trovati: ${trovati} / ${totale}`;
    if(trovati === totale){
      msg.textContent = "ğŸ‰ Bravo! Hai trovato tutti gli oggetti!";
    }
  });
});
</script>

</body>
</html>
