<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ„ Giorno 20 â€“ Attento! Riprova!</title>

<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">

<style>
  body{
    margin:0;
    font-family:'Ubuntu',sans-serif;
    background:#7b0412;
    color:white;
    text-align:center;
  }

  h1{
    color:#ffd700;
    margin:10px 0 4px;
    font-size:1.4em;
  }

  #counter{
    margin:6px 0 6px;
    font-weight:bold;
    color:#ffd700;
  }

  #list{
    font-size:0.9em;
    margin-bottom:10px;
    opacity:0.95;
  }

  /* CONTENITORE GIOCO */
  #game{
    position:relative;
    max-width:380px;
    margin:0 auto;
    touch-action: manipulation;
  }

  #game img{
    width:100%;
    display:block;
    border-radius:12px;
    pointer-events:none; /* IMPORTANTISSIMO: l'immagine non deve prendere i tocchi */
  }

  /* HOTSPOT */
  .item, #grinchTrap{
    position:absolute;
    width:44px;
    height:44px;
    border-radius:50%;
    transform: translate(-50%, -50%); /* top/left = CENTRO */
  }

  .item.found{
    background: rgba(0,255,0,0.18);
    border: 2px solid #00ff99;
    box-shadow: 0 0 7px rgba(0,255,153,0.95);
  }

  /* TRAPPOLA INVISIBILE */
  #grinchTrap{
    width:70px;
    height:70px;
    border-radius:18px;
    background: transparent;
  }

  /* OVERLAY */
  .overlay{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.7);
    display:flex;
    align-items:center;
    justify-content:center;
    z-index:20;
  }

  .overlayBox{
    background:white;
    color:#7b0412;
    padding:20px;
    border-radius:16px;
    max-width:320px;
    text-align:center;
  }

  .overlayBox img{
    width:100%;
    border-radius:12px;
  }

  .overlayBox button{
    margin-top:12px;
    padding:10px 22px;
    border:none;
    border-radius:20px;
    background:#7b0412;
    color:white;
    font-weight:bold;
  }

  /* Nascondi overlay in modo robusto (mobile) */
  .hidden{
    display:none !important;
  }

  #msg{
    margin:10px;
    color:#00ff99;
    font-size:1.1em;
  }

  .btn-back{
    display:inline-block;
    margin:12px auto 18px;
    padding:12px 28px;
    background:#f3e4e4;
    color:black;
    border-radius:30px;
    font-weight:bold;
    text-decoration:none;
  }

  /* BLOCCO DOPPIO TAP (pinch OK) */
  html, body, #game{
    touch-action: manipulation;
  }
</style>
</head>

<body>

<!-- OVERLAY INIZIALE -->
<div id="startOverlay" class="overlay">
  <div class="overlayBox">
    <h2>ğŸ„ Giorno 20</h2>
    <p>
      ğŸ” Trova tutti gli oggetti nascosti nellâ€™immagine.<br><br>
      ğŸ¤ Puoi ingrandire con due dita.<br><br>
      âš ï¸ Attento! Se tocchi il punto sbagliato,<br>
      dovrai <b>riprovarci</b>.
    </p>
    <button id="startBtn">Inizia</button>
  </div>
</div>

<h1>ğŸ„ Giorno 20</h1>
<div id="counter">ğŸ” Oggetti trovati: 0 / 10</div>
<div id="list">ğŸ€ â­ ğŸ§¦ ğŸ‘¢ ğŸ­ ğŸƒ ğŸ•Šï¸ ğŸŸ ğŸ”‘ ğŸ›ï¸</div>

<div id="game">
  <img src="img/disegno.jpg" alt="Disegno Natale">

  <!-- HOTSPOT (CENTRI in %) ricavati dai tuoi cerchi verdi -->
  <div class="item" data-name="fiocco"      style="top:17.2%; left:31.7%;"></div> <!-- ğŸ€ -->
  <div class="item" data-name="stella"      style="top:23.0%; left:91.5%;"></div> <!-- â­ -->
  <div class="item" data-name="calza"       style="top:37.2%; left:16.2%;"></div> <!-- ğŸ§¦ -->
  <div class="item" data-name="scarpa"      style="top:37.3%; left:78.7%;"></div> <!-- ğŸ‘¢ -->
  <div class="item" data-name="topolino"    style="top:49.1%; left:56.3%;"></div> <!-- ğŸ­ -->
  <div class="item" data-name="foglia"      style="top:54.5%; left:33.6%;"></div> <!-- ğŸƒ -->
  <div class="item" data-name="uccellino"   style="top:68.6%; left:10.5%;"></div> <!-- ğŸ•Šï¸ -->
  <div class="item" data-name="pesciolino"  style="top:91.1%; left:28.2%;"></div> <!-- ğŸŸ -->
  <div class="item" data-name="chiave"      style="top:90.2%; left:16.2%;"></div> <!-- ğŸ”‘ -->
  <div class="item" data-name="campanella"  style="top:87.2%; left:56.3%;"></div> <!-- ğŸ›ï¸ -->

  <!-- TRAPPOLA INVISIBILE (mettila dove vuoi: qui vicino al volto di Babbo) -->
  <div id="grinchTrap" style="top:41%; left:38%;"></div>
</div>

<div id="msg"></div>

<a href="../calendario.html" class="btn-back">â† Calendario</a>

<!-- OVERLAY ERRORE -->
<div id="overlayError" class="overlay hidden">
  <div class="overlayBox">
    <img src="img/cami.png" alt="Attento">
    <p>
      <b>ATTENTO!</b><br>
      Il Grinch sta rubando gli oggettiâ€¦<br>
      <b>Riprova!</b>
    </p>
    <button id="retryBtn">Riprova</button>
  </div>
</div>

<script>
  /* BLOCCO DOPPIO TAP */
  let lastTap = 0;
  document.addEventListener("touchend", e=>{
    const now = Date.now();
    if(now - lastTap < 300) e.preventDefault();
    lastTap = now;
  },{passive:false});

  /* AUDIO UH-OH (beep) */
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  function playUhOh(){
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = "sawtooth";
    osc.frequency.setValueAtTime(220, audioCtx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(110, audioCtx.currentTime + 0.4);
    gain.gain.setValueAtTime(0.25, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.4);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.4);
  }

  /* helper: gestisce bene touch + click */
  function bindTap(el, fn){
    el.addEventListener("touchstart", (e)=>{
      e.preventDefault(); // evita ghost click
      fn();
    }, {passive:false});

    el.addEventListener("click", (e)=>{
      e.preventDefault();
      fn();
    });
  }

  const startOverlay = document.getElementById("startOverlay");
  const overlayError = document.getElementById("overlayError");
  const msg = document.getElementById("msg");
  const counter = document.getElementById("counter");
  const items = document.querySelectorAll(".item");
  const totale = items.length;

  let trovati = 0;
  counter.textContent = `ğŸ” Oggetti trovati: ${trovati} / ${totale}`;

  function startGame(){
    startOverlay.classList.add("hidden");
  }

  function showError(){
    playUhOh();
    overlayError.classList.remove("hidden");
  }

  function restart(){
    trovati = 0;
    counter.textContent = `ğŸ” Oggetti trovati: ${trovati} / ${totale}`;
    msg.textContent = "";
    items.forEach(i=>{
      i.dataset.found = "false";
      i.classList.remove("found");
    });
    overlayError.classList.add("hidden");
  }

  /* Start */
  bindTap(document.getElementById("startBtn"), startGame);

  /* Oggetti */
  items.forEach(i=>{
    i.dataset.found = "false";
    bindTap(i, ()=>{
      if(i.dataset.found === "true") return;
      i.dataset.found = "true";
      i.classList.add("found");
      trovati++;
      counter.textContent = `ğŸ” Oggetti trovati: ${trovati} / ${totale}`;
      if(trovati === totale){
        msg.textContent = "ğŸ‰ Bravo! Hai trovato tutti gli oggetti!";
      }
    });
  });

  /* Trappola */
  bindTap(document.getElementById("grinchTrap"), showError);

  /* Riprova */
  bindTap(document.getElementById("retryBtn"), restart);
</script>

</body>
</html>

