<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>üéÑ Giorno 20 ‚Äì Roccasicura Run</title>

<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  background:#8fd3ff;
  font-family:'Ubuntu',sans-serif;
  text-align:center;
  color:#333;
}

h1{
  margin:10px 0 4px;
  color:#c62828;
  font-size:1.4em;
}

#hud{
  display:flex;
  justify-content:space-around;
  margin-bottom:6px;
  font-weight:bold;
}

canvas{
  border-radius:16px;
  background:#8fd3ff;
  touch-action:manipulation;
}

#msg{
  margin-top:6px;
  font-size:1.1em;
  color:#2e7d32;
}

.btn-back{
  display:inline-block;
  margin:12px auto;
  padding:10px 24px;
  background:#fff;
  color:black;
  border-radius:30px;
  font-weight:bold;
  text-decoration:none;
}
</style>
</head>

<body>

<h1>üéÑ Giorno 20 ‚Äì Roccasicura Run</h1>

<div id="hud">
  <div>‚≠ê <span id="score">0</span></div>
  <div>üö¶ Livello <span id="level">1</span></div>
</div>

<canvas id="game" width="360" height="520"></canvas>

<div id="msg"></div>

<a href="../calendario.html" class="btn-back">‚Üê Calendario</a>

<script>
const nome = localStorage.getItem("utente") || "Ospite";
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* PLAYER */
let playerY = 330;
const playerX = 110;

/* STATO */
let speed = 2.5;
let level = 1;
let score = 0;
let running = true;

/* OGGETTI */
let obstacles = [];
let coins = [];
let snow = [];

/* NEVE */
for(let i=0;i<40;i++){
  snow.push({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    s:1+Math.random()*2
  });
}

/* BACKGROUND */
function drawBackground(){
  // cielo
  ctx.fillStyle="#8fd3ff";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // nuvole
  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.arc(60,80,25,0,Math.PI*2);
  ctx.arc(90,80,30,0,Math.PI*2);
  ctx.arc(120,80,22,0,Math.PI*2);
  ctx.fill();

  // collina gialla
  ctx.fillStyle="#f6d54a";
  ctx.beginPath();
  ctx.moveTo(0,260);
  ctx.quadraticCurveTo(180,230,360,300);
  ctx.lineTo(360,520);
  ctx.lineTo(0,520);
  ctx.closePath();
  ctx.fill();

  // bordo verde
  ctx.strokeStyle="#3aa655";
  ctx.lineWidth=10;
  ctx.stroke();
}

/* NEVE */
function drawSnow(){
  ctx.fillStyle="white";
  snow.forEach(f=>{
    ctx.beginPath();
    ctx.arc(f.x,f.y,f.s,0,Math.PI*2);
    ctx.fill();
    f.y+=f.s;
    if(f.y>canvas.height){f.y=0;f.x=Math.random()*canvas.width;}
  });
}

/* PLAYER */
function drawPlayer(){
  ctx.font="34px serif";
  ctx.fillText("üéÖ", playerX, playerY);
}

/* OSTACOLI */
const obstacleTypes=["üè†","üå≤","‚õ™","üöß"];

function spawnObstacle(){
  obstacles.push({
    x:canvas.width+20,
    y:280+Math.random()*90,
    type:obstacleTypes[Math.floor(Math.random()*obstacleTypes.length)]
  });
}

/* MONETE ANIMATE */
function spawnCoin(){
  coins.push({
    x:canvas.width+20,
    y:260+Math.random()*90,
    frame:0
  });
}

function drawCoins(){
  ctx.font="28px serif";
  coins.forEach(c=>{
    const spin=["ü™ô","üí∞","ü™ô"];
    ctx.fillText(spin[Math.floor(c.frame)%3], c.x, c.y);
    c.frame+=0.2;
    c.x-=speed;
  });
}

/* OSTACOLI */
function drawObstacles(){
  ctx.font="28px serif";
  obstacles.forEach(o=>{
    ctx.fillText(o.type, o.x, o.y);
    o.x-=speed;
  });
}

/* COLLISIONI */
function checkCollision(){
  obstacles.forEach(o=>{
    if(Math.abs(o.x-playerX)<26 && Math.abs(o.y-playerY)<26){
      running=false;
      document.getElementById("msg").textContent =
        `üí• Game Over ${nome}! Punteggio: ${score}`;
    }
  });

  coins.forEach(c=>{
    if(Math.abs(c.x-playerX)<26 && Math.abs(c.y-playerY)<26){
      score++;
      document.getElementById("score").textContent=score;
      c.x=-100;

      if(score%5===0){
        level++;
        speed+=0.6;
        document.getElementById("level").textContent=level;
      }
    }
  });
}

/* LOOP */
function loop(){
  if(!running) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawBackground();
  drawSnow();
  drawCoins();
  drawObstacles();
  drawPlayer();
  checkCollision();
  requestAnimationFrame(loop);
}

/* SPAWN */
setInterval(()=>{if(running) spawnObstacle();},1400);
setInterval(()=>{if(running) spawnCoin();},900);

/* CONTROLLI */
window.addEventListener("keydown",e=>{
  if(e.key==="ArrowUp") playerY-=30;
  if(e.key==="ArrowDown") playerY+=30;
});

canvas.addEventListener("touchstart",e=>{
  const y=e.touches[0].clientY;
  if(y<canvas.height/2) playerY-=30;
  else playerY+=30;
});

/* START */
loop();
</script>

</body>
</html>
