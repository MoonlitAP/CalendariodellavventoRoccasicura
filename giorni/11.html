<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>üéÖ Giorno 11 ‚Äì Babbo Mario Run</title>

<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">

<style>
html,body{
  margin:0;
  padding:0;
  font-family:'Ubuntu',sans-serif;
  background:#7b0412;
  color:white;
  text-align:center;
  overflow-x:hidden;
}

h1{color:#ffd700;margin:10px 0;}

canvas{
  width:100%;
  max-width:900px;
  height:300px;
  background:url("img/paese.jpg") repeat-x;
  background-size:cover;
  border:3px solid #ffd700;
  border-radius:14px;
  display:none;
  margin:10px auto;
}

#panel{
  background:#fffaf0;
  color:#400;
  border-radius:16px;
  border:2px solid #ffd700;
  margin:20px;
  padding:20px;
}

button{
  padding:14px 30px;
  border-radius:30px;
  border:none;
  font-size:18px;
  background:#7b0412;
  color:white;
  cursor:pointer;
}
button:hover{background:#ffd700;color:#000;}

#info{
  display:none;
  position:fixed;
  bottom:0;
  width:100%;
  background:rgba(0,0,0,.6);
  padding:8px;
  font-size:18px;
}

#fine{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.7);
  display:none;
  justify-content:center;
  align-items:center;
}
.box{
  background:#fffaf0;
  color:#400;
  border-radius:20px;
  padding:25px;
  width:90%;
  max-width:480px;
  border:2px solid #ffd700;
}
</style>
</head>

<body>

<h1>üéÖ Babbo Mario Run!</h1>

<div id="panel">
  <p>
    üëÜ Tocca per saltare<br>
    ‚¨Ü SPACE / FRECCIA SU = Salta (PC)<br>
    üü´ Evita i blocchi<br>
    ‚≠ê Prendi le stelle (+5)
  </p>
  <button id="start">‚ñ∂Ô∏è INIZIA</button>
</div>

<canvas id="game"></canvas>
<div id="info"></div>

<div id="fine">
  <div class="box">
    <h2 id="msgFinale"></h2>
    <h3>üèÜ Classifica Giorno 11</h3>
    <table id="tabella" style="width:100%"></table>
    <br>
    <button onclick="location.reload()">üîÑ Riprova</button>
  </div>
</div>

<script>
/* -----------------------------
   CANVAS E FISICA DI GIOCO
------------------------------ */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth < 900 ? window.innerWidth : 900;
canvas.height = 300;

const mario = new Image(); mario.src="img/babbo_mario.png";
const block = new Image(); block.src="img/blocco.png";
const star  = new Image(); star.src="img/stella.png";

let mY = 200, vy = 0;
let onGround = true;

let blocks = [];
let stars = [];
let score = 0;
let playing = false;

/* VELOCIT√Ä DIVERSA MOBILE / PC */
let SPEED = window.innerWidth < 700 ? 4 : 5;

/* -----------------------------
   FUNZIONI
------------------------------ */

function jump(){
  if(onGround){
    vy = -13; /* pi√π reattivo */
    onGround = false;
  }
}

/* SALTA CON CLICK, SPACE, FRECCIA SU, CLICK DESTRO */
canvas.addEventListener("click",jump);
window.addEventListener("keydown",e=>{
  if(e.code==="Space" || e.code==="ArrowUp") jump();
});
window.addEventListener("contextmenu",e=>{
  e.preventDefault();
  jump();
});

/* SPAWN OGGETTI */
function spawnBlock(){
  blocks.push({x:canvas.width, y:230});
}
function spawnStar(){
  stars.push({x:canvas.width, y:150});
}

/* LOOP */
function update(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  /* Gravit√† */
  vy += 0.5;
  mY += vy;

  if(mY > 200){
    mY = 200;
    vy = 0;
    onGround = true;
  }

  /* Disegna Babbo Mario */
  ctx.drawImage(mario,70,mY,70,70);

  /* Blocchi */
  blocks.forEach(b=>{
    b.x -= SPEED;
    ctx.drawImage(block,b.x,b.y,60,60);

    /* Collisione */
    if(b.x < 120 && b.x+50 > 70 && mY+60 > b.y){
      endGame();
    }
  });

  /* Stelle */
  stars.forEach(s=>{
    s.x -= SPEED;
    ctx.drawImage(star,s.x,s.y,40,40);

    if(s.x < 120 && s.x+30 > 70 && mY+40 > s.y){
      score += 5;
      s.hit = true;
    }
  });

  blocks = blocks.filter(b=>b.x>-70);
  stars  = stars.filter(s=>!s.hit && s.x>-40);

  document.getElementById("info").textContent = `‚≠ê ${score}`;

  playing && requestAnimationFrame(update);
}

/* -----------------------------
   GAME OVER
------------------------------ */
function endGame(){
  playing = false;
  document.getElementById("game").style.display="none";
  document.getElementById("info").style.display="none";
  document.getElementById("fine").style.display="flex";
  document.getElementById("msgFinale").innerHTML=`‚≠ê Punti: <b>${score}</b>`;
}

/* -----------------------------
   START
------------------------------ */
document.getElementById("start").onclick=()=>{
  document.getElementById("panel").style.display="none";
  canvas.style.display="block";
  document.getElementById("info").style.display="block";
  playing = true;

  setInterval(()=>playing && spawnBlock(), 1600);
  setInterval(()=>playing && spawnStar(), 2300);

  update();
};
</script>

</body>
</html>
