<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ðŸŒ² Giorno 17 â€“ Il Bosco dei Triangoli ðŸ”º</title>

<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  background: linear-gradient(#eef7ee, #dcedc8);
  font-family: 'Ubuntu', sans-serif;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}

#game {
  background: #fff;
  width: 95%;
  max-width: 420px;
  border-radius: 20px;
  padding: 16px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.15);
  text-align: center;
}

h1 {
  font-size: 20px;
  margin: 6px 0 8px;
}

#top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 16px;
  margin-bottom: 6px;
}

#dice {
  font-size: 26px;
}

button {
  background: #2e7d32;
  color: white;
  border: none;
  padding: 10px 18px;
  font-size: 15px;
  border-radius: 14px;
  cursor: pointer;
}

button:active {
  transform: scale(0.96);
}

canvas {
  margin: 14px auto;
  display: block;
  background: #f3f9e9;
  border-radius: 16px;
  touch-action: none;
}

#info {
  font-size: 14px;
  line-height: 1.5;
}
</style>
</head>

<body>

<div id="game">
  <h1>ðŸŒ² Giorno 17 â€“ Il Bosco dei Triangoli ðŸ”º</h1>

  <div id="top">
    <div id="dice">ðŸŽ² -</div>
    <div>ðŸ”º <b id="score">0</b></div>
  </div>

  <button onclick="rollDice()">ðŸŽ² Lancia il dado</button>

  <canvas id="canvas" width="360" height="360"></canvas>

  <div id="info">
    ðŸŽ¯ <b>Obiettivo</b><br>
    Collega gli ðŸŒ² alberi e trova piÃ¹ ðŸ”º triangoli possibile.<br><br>
    ðŸ”º Triangolo chiuso = +1 punto
  </div>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let diceValue = 0;
let selected = [];
let edges = [];
let trianglesFound = 0;

const trees = [
  {x:60,y:60},{x:180,y:60},{x:300,y:60},
  {x:60,y:180},{x:180,y:180},{x:300,y:180},
  {x:60,y:300},{x:180,y:300},{x:300,y:300}
];

draw();

/* ðŸŽ² LANCIO DADO */
function rollDice(){
  diceValue = Math.floor(Math.random()*6) + 2;
  document.getElementById("dice").textContent = "ðŸŽ² " + diceValue;
  selected = [];
  edges = [];
  draw();
}

/* ðŸ–±ï¸ + ðŸ‘† */
canvas.addEventListener("pointerdown", handlePointer);

function handlePointer(e){
  if(!diceValue) return;

  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;

  trees.forEach((t,i)=>{
    if(Math.hypot(t.x-x,t.y-y) < 22){
      if(selected.length === 0 || selected[selected.length-1] !== i){
        if(selected.length < diceValue){
          selected.push(i);
          if(selected.length > 1){
            edges.push([selected[selected.length-2], i]);
            checkTriangles();
          }
          draw();
        }
      }
    }
  });
}

/* ðŸ”º CONTROLLO TRIANGOLI */
function checkTriangles(){
  const n = selected.length;
  if(n < 3) return;

  for(let i=0;i<n;i++){
    for(let j=i+1;j<n;j++){
      for(let k=j+1;k<n;k++){
        if(hasEdge(i,j) && hasEdge(j,k) && hasEdge(i,k)){
          trianglesFound++;
          document.getElementById("score").textContent = trianglesFound;
          selected = [];
          edges = [];
          diceValue = 0;
          document.getElementById("dice").textContent = "ðŸŽ² -";
          draw();
          return;
        }
      }
    }
  }
}

function hasEdge(a,b){
  return edges.some(e =>
    (e[0]===a && e[1]===b) || (e[0]===b && e[1]===a)
  );
}

/* ðŸŽ¨ DISEGNO */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  edges.forEach(e=>{
    ctx.strokeStyle = "#1b5e20";
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(trees[e[0]].x, trees[e[0]].y);
    ctx.lineTo(trees[e[1]].x, trees[e[1]].y);
    ctx.stroke();
  });

  ctx.font = "32px serif";
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  trees.forEach(t=>{
    ctx.fillText("ðŸŒ²", t.x, t.y);
  });
}
</script>

</body>
</html>