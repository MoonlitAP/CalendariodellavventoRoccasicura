<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸŒ² Giorno 17 â€“ Il Bosco dei Triangoli ğŸ”º</title>

<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family: 'Ubuntu', sans-serif;
  background: linear-gradient(#eef7ee,#dcedc8);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
#game{
  background:#fff;
  width:95%;
  max-width:420px;
  border-radius:22px;
  padding:18px;
  box-shadow:0 10px 25px rgba(0,0,0,.15);
  text-align:center;
}
h1{ font-size:20px; margin:0 0 10px; }
#top{
  display:flex;
  justify-content:space-between;
  font-size:16px;
  margin-bottom:10px;
}
button{
  background:#2e7d32;
  color:#fff;
  border:none;
  padding:12px 22px;
  font-size:15px;
  border-radius:14px;
  cursor:pointer;
}
canvas{
  margin:16px auto;
  display:block;
  background:#f3f9e9;
  border-radius:18px;
  touch-action:none;
}
#info{
  font-size:14px;
  line-height:1.5;
}
</style>
</head>

<body>

<div id="game">
  <h1>ğŸŒ² Giorno 17 â€“ Il Bosco dei Triangoli ğŸ”º</h1>

  <div id="top">
    <div>ğŸ‘¤ ğŸ”º <b id="pScore">0</b></div>
    <div>ğŸ–¥ï¸ ğŸ”º <b id="pcScore">0</b></div>
  </div>

  <button onclick="startGame()">ğŸ² Inizia partita</button>

  <canvas id="canvas" width="330" height="330"></canvas>

  <div id="info">
    ğŸ¯ <b>Obiettivo</b><br>
    A turno aggiungete una linea.<br>
    ğŸ”º Triangolo chiuso = +1 punto<br>
    âŒ Nessuna linea puÃ² essere ripetuta
  </div>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const trees = [
  {x:55,y:55},{x:165,y:55},{x:275,y:55},
  {x:55,y:165},{x:165,y:165},{x:275,y:165},
  {x:55,y:275},{x:165,y:275},{x:275,y:275}
];

let edges = new Set();
let triangles = new Set();
let playerScore = 0;
let pcScore = 0;
let turn = "player";
let lastNode = null;

draw();

/* START */
function startGame(){
  edges.clear();
  triangles.clear();
  playerScore = pcScore = 0;
  lastNode = null;
  turn = "player";
  updateScore();
  draw();
}

/* PLAYER MOVE */
canvas.addEventListener("pointerdown", e=>{
  if(turn !== "player") return;

  const r = canvas.getBoundingClientRect();
  const x = e.clientX - r.left;
  const y = e.clientY - r.top;

  trees.forEach((t,i)=>{
    if(Math.hypot(t.x-x,t.y-y)<22){
      if(lastNode === null){
        lastNode = i;
      } else {
        if(addEdge(lastNode, i)){
          checkTriangles("player");
          lastNode = null;
          turn = "pc";
          draw();
          setTimeout(pcMove, 600);
        }
      }
    }
  });
});

/* ADD EDGE */
function addEdge(a,b){
  if(a === b) return false;
  const key = [a,b].sort().join("-");
  if(edges.has(key)) return false;
  edges.add(key);
  return true;
}

/* PC MOVE */
function pcMove(){
  const possible = [];
  for(let i=0;i<9;i++){
    for(let j=i+1;j<9;j++){
      const k = [i,j].join("-");
      if(!edges.has(k)) possible.push([i,j]);
    }
  }

  if(possible.length === 0){
    endGame();
    return;
  }

  const move = possible[Math.floor(Math.random()*possible.length)];
  addEdge(move[0], move[1]);
  checkTriangles("pc");
  turn = "player";
  draw();
}

/* TRIANGLES */
function checkTriangles(who){
  for(let i=0;i<9;i++){
    for(let j=i+1;j<9;j++){
      for(let k=j+1;k<9;k++){
        if(
          hasEdge(i,j)&&hasEdge(j,k)&&hasEdge(i,k)
        ){
          const t = [i,j,k].join("-");
          if(!triangles.has(t)){
            triangles.add(t);
            if(who==="player") playerScore++;
            else pcScore++;
            updateScore();
          }
        }
      }
    }
  }
}

function hasEdge(a,b){
  return edges.has([a,b].sort().join("-"));
}

/* DRAW */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  edges.forEach(e=>{
    const [a,b] = e.split("-").map(Number);
    ctx.strokeStyle="#1b5e20";
    ctx.lineWidth=4;
    ctx.beginPath();
    ctx.moveTo(trees[a].x,trees[a].y);
    ctx.lineTo(trees[b].x,trees[b].y);
    ctx.stroke();
  });

  ctx.font="30px serif";
  ctx.textAlign="center";
  ctx.textBaseline="middle";
  trees.forEach(t=>ctx.fillText("ğŸŒ²",t.x,t.y));
}

/* UI */
function updateScore(){
  document.getElementById("pScore").textContent = playerScore;
  document.getElementById("pcScore").textContent = pcScore;
}

function endGame(){
  let msg = "ğŸ Fine partita!\n";
  msg += playerScore>pcScore ? "ğŸ† Hai vinto!" :
         playerScore<pcScore ? "ğŸ˜… Vince il PC!" :
         "ğŸ¤ Pareggio!";
  alert(msg);
}
</script>

</body>
</html>
