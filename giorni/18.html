<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéÑ Giorno 18 ‚Äì Il Numero Preferito</title>

<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">

<style>
/* ===== BASE ===== */
body{
  margin:0;
  background-color:#7b0412;
  font-family:'Ubuntu',sans-serif;
  color:#fff;
  text-align:center;
}

/* ===== TITOLO ===== */
h1{
  color:#ffd700;
  margin:10px 0;
}

/* ===== CONTENITORE ===== */
#game{
  max-width:420px;
  margin:0 auto;
  padding:10px;
  position:relative;
}

/* ===== INFO ===== */
#top{
  display:flex;
  justify-content:space-between;
  font-size:1.1em;
  color:#ffd700;
}

/* ===== CANVAS ===== */
canvas{
  display:block;
  margin:20px auto;
  background:#fffaf2;
  border:3px solid #f5d97c;
  border-radius:12px;
  touch-action:none;
}

/* ===== SOMMA ===== */
#sum{
  font-size:1.2em;
  margin-bottom:10px;
  color:#fffaf2;
}

/* ===== MODALI ===== */
.modal{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.65);
  backdrop-filter:blur(4px);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:999;
}

.box{
  background:#fffaf2;
  color:#400000;
  padding:25px;
  border-radius:20px;
  width:90%;
  max-width:380px;
  border:2px solid #ffd700;
  animation:popup .4s ease-out;
}

@keyframes popup{
  from{transform:scale(.7);opacity:0;}
  to{transform:scale(1);opacity:1;}
}

/* ===== BOTTONI ===== */
button{
  margin-top:15px;
  padding:12px 30px;
  border-radius:30px;
  font-weight:bold;
  border:none;
  cursor:pointer;
  background:#7b0412;
  color:white;
  transition:.3s;
}
button:hover{
  background:#ffd700;
  color:#000;
}

/* ===== ANIMAZIONI ===== */
.success{animation:pop .4s;}
.error{animation:shake .4s;}

@keyframes pop{
  0%{transform:scale(1);}
  50%{transform:scale(1.1);}
  100%{transform:scale(1);}
}
@keyframes shake{
  0%{transform:translateX(0);}
  25%{transform:translateX(-6px);}
  50%{transform:translateX(6px);}
  75%{transform:translateX(-6px);}
  100%{transform:translateX(0);}
}
</style>
</head>

<body>

<h1>üéÑ Giorno 18 ‚Äì Il Numero Preferito</h1>

<div id="game">
  <div id="top">
    <div>üéØ <span id="target">0</span></div>
    <div>‚≠ê <span id="score">0</span>/10</div>
  </div>

  <canvas id="canvas" width="330" height="330"></canvas>

  <div id="sum">Somma: <b id="currentSum">0</b></div>
</div>

<!-- START -->
<div class="modal" id="startModal">
  <div class="box">
    <h2>üéØ Come si gioca</h2>
    <p>
      Tocca i numeri.<br>
      ‚ûï La somma deve essere uguale<br>
      al <b>Numero Preferito</b>.<br><br>
      ‚úÖ Giusto = ‚≠ê punto<br>
      ‚ùå Se superi ‚Üí errore<br>
      üèÅ 10 sfide totali
    </p>
    <button onclick="startGame()">‚ñ∂Ô∏è Inizia</button>
  </div>
</div>

<!-- END -->
<div class="modal" id="endModal" style="display:none;">
  <div class="box">
    <h2 id="endTitle"></h2>
    <p id="endText"></p>
    <a href="../calendario.html" class="btn">‚¨Ö Torna al Calendario</a>
  </div>
</div>

<script>
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

const cells=[];
let target=0,sum=0,score=0,round=0;
const size=3,cellSize=110;

function startGame(){
  document.getElementById("startModal").style.display="none";
  startRound();
}

function startRound(){
  if(round===10){ endGame(); return; }
  round++;
  sum=0;
  cells.length=0;
  target=Math.floor(Math.random()*11)+10;
  document.getElementById("target").textContent=target;
  document.getElementById("currentSum").textContent=0;

  for(let y=0;y<3;y++)
    for(let x=0;x<3;x++)
      cells.push({x:x*cellSize,y:y*cellSize,v:Math.floor(Math.random()*9)+1});

  draw();
}

canvas.addEventListener("pointerdown",e=>{
  const r=canvas.getBoundingClientRect();
  const x=e.clientX-r.left,y=e.clientY-r.top;

  cells.forEach(c=>{
    if(x>c.x && x<c.x+cellSize && y>c.y && y<c.y+cellSize){
      sum+=c.v;
      document.getElementById("currentSum").textContent=sum;

      if(sum===target){
        score++;
        document.getElementById("score").textContent=score;
        game.classList.add("success");
        setTimeout(()=>{game.classList.remove("success");startRound();},600);
      }else if(sum>target){
        game.classList.add("error");
        setTimeout(()=>{game.classList.remove("error");startRound();},600);
      }
    }
  });
});

function endGame(){
  const title=document.getElementById("endTitle");
  const text=document.getElementById("endText");
  document.getElementById("endModal").style.display="flex";

  if(score===10){
    title.textContent="üèÜ Hai vinto!";
    text.innerHTML="10 su 10 ‚≠ê<br><br>Anche una semplice addizione<br>pu√≤ avere molte soluzioni.";
  }else{
    title.textContent="‚ú® Ci sei quasi!";
    text.innerHTML=`Hai fatto ${score} su 10 ‚≠ê<br><br>Riprova e migliora la strategia.`;
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  cells.forEach(c=>{
    ctx.fillStyle="#fff";
    ctx.strokeStyle="#7b0412";
    ctx.lineWidth=3;
    ctx.fillRect(c.x,c.y,cellSize,cellSize);
    ctx.strokeRect(c.x,c.y,cellSize,cellSize);
    ctx.fillStyle="#400000";
    ctx.font="bold 32px Ubuntu";
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    ctx.fillText(c.v,c.x+cellSize/2,c.y+cellSize/2);
  });
}
</script>

</body>
</html>
