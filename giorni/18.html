<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéÑ Giorno 18 ‚Äì Il Numero Preferito</title>

<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  background-color:#7b0412;
  font-family:'Ubuntu',sans-serif;
  color:#fff;
  text-align:center;
}

h1{
  color:#ffd700;
  margin:10px 0;
}

#top{
  display:flex;
  justify-content:space-between;
  padding:0 20px;
  font-size:1.1em;
  color:#ffd700;
}

canvas{
  display:block;
  margin:20px auto;
  background:#fffaf2;
  border:3px solid #f5d97c;
  border-radius:12px;
  touch-action:none;
}

#sum{
  font-size:1.2em;
  margin-bottom:10px;
}

/* MODALS */
.modal{
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background:rgba(0,0,0,0.65);
  backdrop-filter:blur(4px);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:999;
}

.box{
  background:#fffaf2;
  color:#400000;
  padding:25px;
  border-radius:20px;
  width:90%;
  max-width:380px;
  border:2px solid #ffd700;
}

button{
  margin-top:15px;
  padding:12px 30px;
  border-radius:30px;
  font-weight:bold;
  border:none;
  cursor:pointer;
  background:#7b0412;
  color:white;
}
button:hover{
  background:#ffd700;
  color:black;
}

/* ANIMAZIONI */
.success{animation:pop .4s;}
.error{animation:shake .4s;}

@keyframes pop{
  0%{transform:scale(1);}
  50%{transform:scale(1.1);}
  100%{transform:scale(1);}
}
@keyframes shake{
  0%{transform:translateX(0);}
  25%{transform:translateX(-6px);}
  50%{transform:translateX(6px);}
  75%{transform:translateX(-6px);}
  100%{transform:translateX(0);}
}
</style>
</head>

<body>

<h1>üéÑ Giorno 18 ‚Äì Il Numero Preferito</h1>

<div id="top">
  <div>üéØ <span id="target">0</span></div>
  <div>‚≠ê <span id="score">0</span>/10</div>
</div>

<canvas id="canvas" width="330" height="330"></canvas>

<div id="sum">Somma: <b id="currentSum">0</b></div>

<!-- START -->
<div class="modal" id="startModal">
  <div class="box">
    <h2>üéØ Come si gioca</h2>
    <p>
      Tocca le caselle una sola volta.<br>
      ‚ûï La somma deve essere uguale<br>
      al <b>Numero Preferito</b>.<br><br>
      üü© Le caselle selezionate si colorano<br>
      ‚ùå Non puoi tornare indietro<br>
      ‚ùå Se superi ‚Üí errore<br><br>
      üèÅ 10 sfide totali
    </p>
    <button onclick="startGame()">‚ñ∂Ô∏è Inizia</button>
  </div>
</div>

<!-- END -->
<div class="modal" id="endModal" style="display:none;">
  <div class="box">
    <h2 id="endTitle"></h2>
    <p id="endText"></p>
    <a href="../calendario.html">‚¨Ö Torna al Calendario</a>
  </div>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let cells=[];
let target=0, sum=0, score=0, round=0;

const size=3;
const cellSize=110;

/* START */
function startGame(){
  document.getElementById("startModal").style.display="none";
  startRound();
}

/* ROUND */
function startRound(){
  if(round === 10){
    endGame();
    return;
  }

  round++;
  sum = 0;
  cells = [];

  target = Math.floor(Math.random()*11) + 10;
  document.getElementById("target").textContent = target;
  document.getElementById("currentSum").textContent = sum;

  for(let y=0;y<3;y++){
    for(let x=0;x<3;x++){
      cells.push({
        x:x*cellSize,
        y:y*cellSize,
        v:Math.floor(Math.random()*9)+1,
        used:false
      });
    }
  }
  draw();
}

/* CLICK */
canvas.addEventListener("pointerdown", e=>{
  const r = canvas.getBoundingClientRect();
  const mx = e.clientX - r.left;
  const my = e.clientY - r.top;

  cells.forEach(c=>{
    if(c.used) return;

    if(mx>c.x && mx<c.x+cellSize && my>c.y && my<c.y+cellSize){
      c.used = true;
      sum += c.v;
      document.getElementById("currentSum").textContent = sum;

      if(sum === target){
        score++;
        document.getElementById("score").textContent = score;
        game.classList.add("success");
        setTimeout(()=>{ game.classList.remove("success"); startRound(); },600);
      }
      else if(sum > target){
        game.classList.add("error");
        setTimeout(()=>{ game.classList.remove("error"); startRound(); },600);
      }

      draw();
    }
  });
});

/* END GAME */
function endGame(){
  const modal = document.getElementById("endModal");
  const title = document.getElementById("endTitle");
  const text = document.getElementById("endText");

  if(score === 10){
    title.textContent = "üèÜ Hai vinto!";
    text.innerHTML = "10 su 10 ‚≠ê<br><br>In matematica conta il percorso,<br>non solo il risultato.";
  }else{
    title.textContent = "‚ú® Ci sei quasi!";
    text.innerHTML = `Hai fatto ${score} su 10 ‚≠ê<br><br>Riprova e migliora la strategia.`;
  }

  modal.style.display = "flex";
}

/* DRAW */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  cells.forEach(c=>{
    ctx.fillStyle = c.used ? "#9ccc65" : "#fff";
    ctx.strokeStyle = "#7b0412";
    ctx.lineWidth = 3;
    ctx.fillRect(c.x,c.y,cellSize,cellSize);
    ctx.strokeRect(c.x,c.y,cellSize,cellSize);

    ctx.fillStyle = "#400000";
    ctx.font = "bold 32px Ubuntu";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText(c.v, c.x+cellSize/2, c.y+cellSize/2);
  });
}
</script>

</body>
</html>
