<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéÑ Giorno 18 ‚Äì Il Numero Preferito üî¢</title>

<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Ubuntu',sans-serif;
  background:linear-gradient(#fce4ec,#e8f5e9);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
#game{
  background:#fff;
  width:95%;
  max-width:420px;
  border-radius:22px;
  padding:18px;
  box-shadow:0 10px 25px rgba(0,0,0,.15);
  text-align:center;
  position:relative;
}
h1{font-size:20px;margin:0 0 8px;}

#top{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:8px;
}
#target{
  font-size:30px;
  font-weight:700;
  color:#d32f2f;
}
#score{
  font-size:18px;
}

canvas{
  background:#f9fbe7;
  border-radius:18px;
  display:block;
  margin:12px auto;
  touch-action:none;
}

#sum{
  font-size:18px;
}

/* MODALS */
.modal{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.45);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:10;
}
.modalContent{
  background:#fff;
  padding:20px;
  border-radius:18px;
  width:90%;
  max-width:320px;
  text-align:center;
}
.modalContent button{
  background:#2e7d32;
  color:#fff;
  border:none;
  padding:12px 22px;
  font-size:15px;
  border-radius:14px;
  cursor:pointer;
}
.success{
  animation: pop .4s ease;
}
@keyframes pop{
  0%{transform:scale(1);}
  50%{transform:scale(1.1);}
  100%{transform:scale(1);}
}
</style>
</head>

<body>

<div id="game">
  <h1>üéÑ Giorno 18 ‚Äì Il Numero Preferito üî¢</h1>

  <div id="top">
    <div>üéØ <span id="target">0</span></div>
    <div>‚≠ê <span id="score">0</span>/10</div>
  </div>

  <canvas id="canvas" width="330" height="330"></canvas>

  <div id="sum">Somma: <b id="currentSum">0</b></div>

  <!-- START MODAL -->
  <div class="modal" id="startModal">
    <div class="modalContent">
      <h2>üéØ Come si gioca</h2>
      <p>
        Tocca i numeri nel tabellone.<br>
        ‚ûï La loro somma deve essere uguale<br>
        al <b>Numero Preferito</b>.<br><br>
        üîÅ Puoi toccare di nuovo un numero<br>
        per toglierlo dalla somma.<br><br>
        ‚≠ê Somma giusta = 1 punto<br>
        üèÅ Dopo <b>10 sfide</b> il gioco termina
      </p>
      <button onclick="startGame()">‚ú® Inizia</button>
    </div>
  </div>

  <!-- END MODAL -->
  <div class="modal" id="endModal" style="display:none;">
    <div class="modalContent">
      <h2 id="endTitle">üèÅ Fine gioco</h2>
      <p id="endText"></p>
    </div>
  </div>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const cells=[];
let selected=[];
let target=0;
let sum=0;
let score=0;
let round=0;

const size=3;
const cellSize=110;

/* START */
function startGame(){
  document.getElementById("startModal").style.display="none";
  startRound();
}

/* ROUND */
function startRound(){
  if(round === 10){
    showEnd();
    return;
  }

  round++;
  cells.length=0;
  selected=[];
  sum=0;

  target=Math.floor(Math.random()*11)+10; // 10‚Äì20
  document.getElementById("target").textContent=target;
  document.getElementById("currentSum").textContent=sum;

  for(let y=0;y<size;y++){
    for(let x=0;x<size;x++){
      cells.push({
        x:x*cellSize,
        y:y*cellSize,
        v:Math.floor(Math.random()*9)+1
      });
    }
  }
  draw();
}

/* CLICK ‚Äì toggle selezione */
canvas.addEventListener("pointerdown",e=>{
  const r=canvas.getBoundingClientRect();
  const x=e.clientX-r.left;
  const y=e.clientY-r.top;

  cells.forEach((c,i)=>{
    if(x>c.x && x<c.x+cellSize && y>c.y && y<c.y+cellSize){

      if(selected.includes(i)){
        selected = selected.filter(n => n !== i);
        sum -= c.v;
      }else{
        selected.push(i);
        sum += c.v;
      }

      document.getElementById("currentSum").textContent=sum;

      if(sum === target){
        score++;
        document.getElementById("score").textContent=score;
        document.getElementById("game").classList.add("success");
        setTimeout(()=>{
          document.getElementById("game").classList.remove("success");
          startRound();
        },600);
      }

      draw();
    }
  });
});

/* END GAME */
function showEnd(){
  const title = document.getElementById("endTitle");
  const text = document.getElementById("endText");
  const modal = document.getElementById("endModal");

  if(score === 10){
    title.textContent = "üèÜ Hai vinto!";
    text.innerHTML = `
      Hai risolto <b>10 su 10</b> Numeri Preferiti ‚≠ê<br><br>
      Anche una semplice addizione<br>
      pu√≤ avere molte soluzioni.<br>
      In matematica conta il percorso,<br>
      non solo il risultato.
    `;
  }else{
    title.textContent = "‚ú® Ci sei quasi!";
    text.innerHTML = `
      Hai risolto <b>${score} su 10</b> sfide ‚≠ê<br><br>
      Riprova: ogni tentativo<br>
      allena la mente e migliora la strategia.
    `;
  }

  modal.style.display="flex";
}

/* DRAW */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  cells.forEach((c,i)=>{
    ctx.fillStyle=selected.includes(i)?"#aed581":"#fff";
    ctx.strokeStyle="#8d6e63";
    ctx.lineWidth=3;
    ctx.fillRect(c.x,c.y,cellSize,cellSize);
    ctx.strokeRect(c.x,c.y,cellSize,cellSize);

    ctx.fillStyle="#000";
    ctx.font="bold 32px Ubuntu";
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    ctx.fillText(c.v,c.x+cellSize/2,c.y+cellSize/2);
  });
}
</script>

</body>
</html>
