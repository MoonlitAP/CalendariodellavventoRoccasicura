<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>üê∞ Bunny Garden Adventure</title>
<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root { 
    --grass: #7bc043; 
    --path: #f9f1dc; 
    --wood: #6d4c41;
    --win-gold: #ffeb3b;
  }
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  
  body { 
    margin: 0; font-family: 'Ubuntu', sans-serif; background: #e3f2fd; 
    display: flex; flex-direction: column; align-items: center; justify-content: flex-start; 
    height: 100vh; padding: 10px; overflow: hidden;
  }

  h1 { color: #2e7d32; margin: 5px 0; font-size: 22px; text-shadow: 1px 1px white; }

  /* Tabellone Garden */
  #game-world {
    position: relative; 
    width: 100%; 
    max-width: 500px; 
    height: 70vh; 
    background: var(--grass); 
    border: 8px solid #4caf50; 
    border-radius: 30px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    background-image: radial-gradient(#9ccc65 10%, transparent 20%);
    background-size: 30px 30px;
    overflow: hidden;
  }

  /* Caselle Sentiero */
  .tile { 
    width: 42px; height: 42px; 
    background: var(--path); 
    border-radius: 12px; 
    position: absolute; 
    display: flex; align-items: center; justify-content: center; 
    font-size: 15px; font-weight: bold; color: #5d4037;
    border-bottom: 4px solid #d7ccc8;
    box-shadow: 0 4px 0 rgba(0,0,0,0.1);
    z-index: 5;
    transition: all 0.3s;
  }

  .hole { background: #333 !important; border-bottom-color: #000; color: transparent !important; box-shadow: inset 0 4px 10px #000; }

  /* Casella Vittoria 0 */
  #finish-line {
    width: 70px; height: 70px; 
    background: var(--win-gold); 
    border: 4px solid #fbc02d;
    border-radius: 20px;
    position: absolute;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    z-index: 10;
    box-shadow: 0 0 20px rgba(255, 235, 59, 0.5);
  }
  .carrot { font-size: 35px; }
  .zero { font-size: 14px; font-weight: bold; color: #f57f17; }

  /* Coniglietti */
  .bunny { 
    width: 38px; height: 38px; position: absolute; z-index: 20;
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    background-size: contain; background-repeat: no-repeat; background-position: center;
    filter: drop-shadow(0 3px 3px rgba(0,0,0,0.3));
  }
  .p-bunny { background-image: url('img/rabbit_1.png'); }
  .c-bunny { background-image: url('img/rabbit_2.png'); }

  .jumping { animation: hop-hop 0.4s infinite alternate; }
  @keyframes hop-hop { from { transform: scale(1); } to { transform: scale(1.2) translateY(-10px); } }

  /* Basi Recinto */
  .base {
    position: absolute; width: 70px; height: 120px;
    background: #a1887f; border: 4px solid var(--wood); border-radius: 15px;
    display: flex; flex-wrap: wrap; align-items: center; justify-content: center;
    z-index: 2; padding: 5px;
  }
  .base-player { left: 10px; bottom: 10px; }
  .base-cpu { right: 10px; top: 10px; }
  .base::after { content: 'TANA'; position: absolute; top: -18px; font-size: 10px; font-weight: bold; color: var(--wood); }

  /* Decorazioni */
  .decor { position: absolute; font-size: 20px; z-index: 1; opacity: 0.6; pointer-events: none; }

  /* UI Pannello */
  .controls { width: 100%; max-width: 500px; padding: 15px; text-align: center; }
  #msg {
    background: white; padding: 15px; border-radius: 50px; border: 3px solid #4caf50;
    margin-bottom: 10px; font-weight: bold; color: #1b5e20;
  }
  .btn-dice {
    width: 100%; padding: 15px; border: none; border-radius: 50px;
    background: #ff9800; color: white; font-size: 20px; font-weight: bold;
    box-shadow: 0 6px 0 #e65100; cursor: pointer;
  }
  .btn-dice:active { transform: translateY(4px); box-shadow: 0 2px 0 #e65100; }
  .btn-dice:disabled { background: #ccc; box-shadow: 0 4px 0 #999; }

</style>
</head>
<body>

<h1>üê∞ GARDEN RACE 30 ‚Üí 0</h1>

<div id="game-world">
  <div class="base base-player" id="p-tana"></div>
  <div class="base base-cpu" id="c-tana"></div>
  
  <div id="finish-line">
    <div class="carrot">ü•ï</div>
    <div class="zero">TRAGUARDO 0</div>
  </div>

  <div class="decor" style="top:10%; left:20%">üå∏</div>
  <div class="decor" style="bottom:15%; right:25%">üåª</div>
  <div class="decor" style="top:50%; left:5%">üåº</div>
  <div class="decor" style="bottom:40%; right:10%">üçÉ</div>
</div>

<div class="controls">
  <div id="msg">Tira il dado per iniziare l'avventura!</div>
  <button id="diceBtn" class="btn-dice" onclick="roll()">üé≤ TIRA IL DADO</button>
</div>

<script>
const world = document.getElementById("game-world");
const finish = document.getElementById("finish-line");
const msg = document.getElementById("msg");
const diceBtn = document.getElementById("diceBtn");

let turn = "player";
let lastDice = 0;
let gameState = "idle";
let holes = [25, 18, 9, 4];
const points = [];

// CREAZIONE PERCORSO A "S" (Come l'immagine dei pesci)
function createPath() {
  const cols = 5;
  const rows = 7;
  const padding = 50;
  
  for (let i = 0; i < 31; i++) {
    // Calcolo riga e colonna per lo zig-zag
    let row = Math.floor(i / cols);
    let col = i % cols;
    
    // Inverte la direzione ogni riga per fare la "S"
    if (row % 2 !== 0) col = (cols - 1) - col;

    const x = 60 + col * 85;
    const y = 80 + row * 80;
    points.push({ x, y });
  }
  // L'ultimo punto (30) √® il traguardo
  finish.style.left = points[30].x - 35 + "px";
  finish.style.top = points[30].y - 35 + "px";
}

function renderPath() {
  document.querySelectorAll('.tile').forEach(t => t.remove());
  points.forEach((p, i) => {
    if (i === 30) return; // Salta il 30 perch√© c'√® il finish-line
    const num = 30 - i;
    const tile = document.createElement("div");
    tile.className = "tile" + (holes.includes(num) ? " hole" : "");
    tile.style.left = p.x - 21 + "px";
    tile.style.top = p.y - 21 + "px";
    if (!holes.includes(num)) tile.textContent = num;
    world.appendChild(tile);
  });
}

createPath();
renderPath();

// Gestione Conigli
let bunnies = [];
function initBunnies() {
  const pTana = document.getElementById("p-tana");
  const cTana = document.getElementById("c-tana");
  
  for (let i = 0; i < 6; i++) {
    const isP = i < 3;
    const b = document.createElement("div");
    b.className = "bunny " + (isP ? "p-bunny" : "c-bunny");
    b.dataset.pos = -1; // -1 significa in tana
    b.dataset.owner = isP ? "player" : "cpu";
    b.onclick = () => selectBunny(b);
    isP ? pTana.appendChild(b) : cTana.appendChild(b);
    bunnies.push(b);
  }
}

function updateBunny(b) {
  const pos = parseInt(b.dataset.pos);
  if (pos === -1) {
    const tana = b.dataset.owner === "player" ? "p-tana" : "c-tana";
    document.getElementById(tana).appendChild(b);
    b.style.position = "relative"; b.style.left = "0"; b.style.top = "0"; b.style.transform = "none";
  } else {
    world.appendChild(b);
    b.style.position = "absolute";
    const coord = points[30 - pos];
    b.style.left = coord.x - 19 + "px";
    b.style.top = coord.y - 19 + "px";
    b.style.transform = "translate(0,0)";
  }
}

initBunnies();

// Logica Gioco
function roll() {
  lastDice = Math.floor(Math.random() * 6) + 1;
  diceBtn.disabled = true;
  msg.innerHTML = `üé≤ Risultato: <b>${lastDice}</b>`;
  
  if (lastDice === 6) {
    msg.innerHTML = "üåÄ <b>6!</b> I buchi si spostano!";
    shuffleHoles();
    setTimeout(prepareMove, 800);
  } else {
    prepareMove();
  }
}

function shuffleHoles() {
  let newH = [];
  while(newH.length < 4) {
    let r = Math.floor(Math.random() * 28) + 1;
    if(!newH.includes(r)) newH.push(r);
  }
  holes = newH;
  renderPath();
}

function prepareMove() {
  if (turn === "player") {
    gameState = "picking";
    bunnies.filter(b => b.dataset.owner === "player").forEach(b => b.classList.add("jumping"));
    msg.innerHTML += " - Tocca un coniglio!";
  } else {
    setTimeout(cpuMove, 1000);
  }
}

function selectBunny(b) {
  if (gameState !== "picking" || b.dataset.owner !== "player") return;
  bunnies.forEach(x => x.classList.remove("jumping"));
  moveBunny(b);
}

function moveBunny(b) {
  gameState = "moving";
  let current = parseInt(b.dataset.pos);
  if (current === -1) current = 31; // Entra nel percorso
  
  let target = current - lastDice;

  if (target <= 0) {
    b.dataset.pos = 0;
    updateBunny(b);
    msg.innerHTML = turn === "player" ? "üèÜ VITTORIA! LA CAROTA √à TUA!" : "ü§ñ LA CPU HA VINTO!";
    setTimeout(() => location.reload(), 5000);
    return;
  }

  b.dataset.pos = target;
  updateBunny(b);

  if (holes.includes(target)) {
    setTimeout(() => {
      b.dataset.pos = -1;
      updateBunny(b);
      msg.innerHTML = "üåÄ OOOPS! Sei caduto in un buco!";
    }, 600);
  }

  setTimeout(endTurn, 1000);
}

function cpuMove() {
  let targets = bunnies.filter(b => b.dataset.owner === "cpu");
  // La CPU muove quello pi√π vicino allo zero
  let chosen = targets.sort((a,b) => a.dataset.pos - b.dataset.pos)[0];
  moveBunny(chosen);
}

function endTurn() {
  turn = (turn === "player") ? "cpu" : "player";
  gameState = "idle";
  msg.innerHTML = turn === "player" ? "Tocca a te!" : "ü§ñ La CPU sta pensando...";
  diceBtn.disabled = (turn === "cpu");
  if (turn === "cpu") setTimeout(roll, 800);
}
</script>
</body>
</html>
