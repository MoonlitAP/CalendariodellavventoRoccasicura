<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üê∞ Giorno 16 ‚Äì Carrera de Conejos PRO</title>
<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">
<style>
  body { margin: 0; font-family: 'Ubuntu', sans-serif; background: #eaf6e6; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; }
  #board { margin: 20px; width: 380px; height: 380px; position: relative; background: #4caf50; border-radius: 50%; border: 8px solid #2e7d32; box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
  
  .cell { 
    width: 30px; height: 30px; background: #ffeb3b; border-radius: 50%; position: absolute; 
    display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold; color: #f57f17; 
  }
  .hole { background: #222; color: transparent; box-shadow: inset 0 4px 6px rgba(0,0,0,0.6); }

  #carrot { 
    width: 50px; height: 50px; background: #ff9800; border-radius: 50%; position: absolute; 
    top: 165px; left: 165px; line-height: 50px; font-size: 28px; z-index: 5; text-align: center;
  }

  .rabbit { 
    width: 24px; height: 24px; border-radius: 50%; position: absolute; z-index: 10; border: 2px solid white; 
    transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: pointer;
  }
  .player { background: #e91e63; box-shadow: 0 0 10px rgba(233,30,99,0.5); }
  .cpu { background: #673ab7; }

  /* Effetto selezione */
  .can-move { animation: pulse 0.8s infinite alternate; border: 3px solid #fff; z-index: 15; }
  @keyframes pulse { from { transform: scale(1); box-shadow: 0 0 5px #fff; } to { transform: scale(1.3); box-shadow: 0 0 20px #fff; } }

  #info { margin-top: 15px; padding: 10px 20px; background: white; border-radius: 15px; font-weight: bold; min-width: 200px; text-align: center; }
  button { padding: 12px 25px; border: none; border-radius: 25px; background: #ff9800; color: white; font-size: 18px; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
  button:disabled { background: #ccc; }
</style>
</head>
<body>

<h1>üê∞ Carrera de Conejos</h1>
<div id="info">Tira il dado per iniziare!</div>
<div id="board"><div id="carrot">ü•ï</div></div>
<button id="diceBtn" onclick="rollDice()">üé≤ Tira il dado</button>

<script>
const board = document.getElementById("board");
const info = document.getElementById("info");
const diceBtn = document.getElementById("diceBtn");

let turn = "player";
let currentDice = 0;
let gameState = "waiting"; // waiting, selecting
const path = [];
const holes = [5, 12, 18, 24]; // Numeri delle caselle (secondo numerazione inversa)

// 1. CREAZIONE PERCORSO SPIRALE (Fibonacci-style)
function createPath() {
  const totalSteps = 30;
  for (let i = 0; i < totalSteps; i++) {
    const angle = 0.5 * i;
    const r = (i * 5) + 25; // Crescita raggio
    const x = 190 + r * Math.cos(angle) - 15;
    const y = 190 + r * Math.sin(angle) - 15;
    path.push({ x, y });
  }
  path.reverse(); // Invertiamo: la 0 √® la pi√π esterna (partenza), l'ultima √® la carota
}
createPath();

// 2. DISEGNO CASELLE (Numerazione 1 vicino alla carota)
path.forEach((p, i) => {
  const cellNum = path.length - i; 
  const c = document.createElement("div");
  c.className = "cell" + (holes.includes(cellNum) ? " hole" : "");
  c.style.left = p.x + "px";
  c.style.top = p.y + "px";
  if (!holes.includes(cellNum)) c.textContent = cellNum;
  board.appendChild(c);
});

// 3. GESTIONE CONIGLI
let rabbits = [];
function initRabbits() {
  for (let i = 0; i < 8; i++) {
    const isPlayer = i < 4;
    const r = document.createElement("div");
    r.className = "rabbit " + (isPlayer ? "player" : "cpu");
    r.pos = -1; // Fuori dal tabellone
    r.id = i;
    r.dataset.type = isPlayer ? "player" : "cpu";
    r.onclick = () => handleRabbitClick(r);
    board.appendChild(r);
    rabbits.push(r);
    updatePosition(r);
  }
}

function updatePosition(r) {
  if (r.pos === -1) {
    r.style.left = r.dataset.type === "player" ? "10px" : "340px";
    r.style.top = (300 + (r.id % 4) * 15) + "px"; // Spaziati in partenza
  } else {
    r.style.left = path[r.pos].x + 3 + "px";
    r.style.top = path[r.pos].y + 3 + "px";
  }
}

initRabbits();

// 4. LOGICA DI GIOCO
function rollDice() {
  currentDice = Math.floor(Math.random() * 6) + 1;
  diceBtn.disabled = true;
  info.innerHTML = `üé≤ Risultato: ${currentDice}. <br> ${turn === 'player' ? 'Scegli quale coniglio muovere!' : 'Il computer sta pensando...'}`;
  
  if (turn === "player") {
    gameState = "selecting";
    highlightMovable(true);
  } else {
    setTimeout(cpuLogic, 1000);
  }
}

function highlightMovable(show) {
  rabbits.forEach(r => {
    if (r.dataset.type === "player") r.classList.toggle("can-move", show);
  });
}

function handleRabbitClick(r) {
  if (gameState !== "selecting" || r.dataset.type !== "player") return;
  moveRabbit(r);
}

function moveRabbit(r) {
  highlightMovable(false);
  gameState = "moving";
  
  r.pos += currentDice;
  if (r.pos >= path.length) {
    endGame("Giocatore");
    return;
  }

  updatePosition(r);

  // Controllo Buco
  const currentCellNum = path.length - r.pos;
  if (holes.includes(currentCellNum)) {
    setTimeout(() => {
      alert("üï≥Ô∏è Caduto in un buco! Si ricomincia.");
      r.pos = -1;
      updatePosition(r);
    }, 600);
  }

  setTimeout(nextTurn, 1000);
}

function cpuLogic() {
  const myRabbits = rabbits.filter(r => r.dataset.type === "cpu");
  // Strategia semplice: muove il coniglio pi√π avanti
  const r = myRabbits.sort((a, b) => b.pos - a.pos)[0];
  
  r.pos += currentDice;
  updatePosition(r);

  const currentCellNum = path.length - r.pos;
  if (holes.includes(currentCellNum)) {
    r.pos = -1;
    setTimeout(() => updatePosition(r), 600);
  }

  if (r.pos >= path.length - 1) {
    endGame("Computer");
  } else {
    setTimeout(nextTurn, 1000);
  }
}

function nextTurn() {
  turn = turn === "player" ? "cpu" : "player";
  gameState = "waiting";
  info.innerHTML = `Turno: ${turn === 'player' ? 'Giocatore' : 'Computer'}`;
  diceBtn.disabled = (turn === "cpu");
  if (turn === "cpu") setTimeout(rollDice, 500);
}

function endGame(winner) {
  alert("üèÜ " + winner + " ha vinto!");
  location.reload();
}
</script>
</body>
</html>
