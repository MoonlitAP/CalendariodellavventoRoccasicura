<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ„ Christmas Garden Race</title>

<style>
/* ===== BASE ===== */
body{
  margin:0;
  font-family: Arial, sans-serif;
  background: linear-gradient(#1b5e20,#2e7d32);
}

.game{
  max-width:430px;
  margin:0 auto;
  height:100vh;
  display:flex;
  flex-direction:column;
  background:#fff;
}

/* ===== HEADER ===== */
.header{
  background:linear-gradient(135deg,#b71c1c,#e53935);
  color:#fff;
  padding:14px;
  text-align:center;
  border-bottom:3px solid gold;
}
.header h1{margin:0;font-size:22px;}
.status{
  display:flex;
  justify-content:space-between;
  font-size:14px;
  margin-top:6px;
}

/* ===== BOARD ===== */
.board{
  flex:1;
  margin:10px;
  padding:10px;
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
  background:#7bc96f;
  border-radius:16px;
}

/* ===== CELLE ===== */
.cell{
  height:64px;
  background:#fff8e1;
  border-radius:16px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  position:relative;
  box-shadow: inset 0 0 0 2px #c62828;
  overflow:hidden;
}

.cell.start{background:#e3f2fd;}
.cell.finish{
  background:linear-gradient(135deg,#ffcc80,#ffb300);
  box-shadow: inset 0 0 0 3px #f57c00;
}

.cell.black{background:#000;color:#fff;}
.cell.gift{background:#e8f5e9;}
.cell.ice{background:#e3f2fd;}

.players{
  position:absolute;
  bottom:4px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:4px;
  font-size:20px;
}

/* ===== HUD / ISTRUZIONI ===== */
.message{
  padding:14px;
  text-align:center;
  font-weight:bold;
  border-top:2px solid #c62828;
  background:linear-gradient(135deg,#fffde7,#fff9c4);
  min-height:56px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
}

/* ===== BUTTON ===== */
.action{
  background:linear-gradient(135deg,#2e7d32,#43a047);
  color:#fff;
  border:none;
  padding:16px;
  font-size:18px;
  font-weight:bold;
}
.action:disabled{background:#9e9e9e;}

/* ===== MODAL ===== */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  align-items:center;
  justify-content:center;
  z-index:1000;
}
.modal .box{
  background:#fff;
  padding:20px;
  border-radius:16px;
  text-align:center;
  max-width:320px;
}
.modal button{
  margin-top:12px;
  padding:12px 18px;
  font-size:16px;
}

/* ===== EFFETTO DADO ===== */
.dice-rolling{
  animation: shake 0.3s infinite;
}

@keyframes shake{
  0%{transform:rotate(0deg);}
  25%{transform:rotate(8deg);}
  50%{transform:rotate(-8deg);}
  75%{transform:rotate(8deg);}
  100%{transform:rotate(0deg);}
}
</style>
</head>

<body>

<div class="game">

<header class="header">
  <h1>ğŸ„ Christmas Garden Race</h1>
  <div class="status">
    <span id="turno">Turno: TU ğŸ°</span>
    <span id="dado">ğŸ² â€”</span>
  </div>
</header>

<main class="board" id="board"></main>

<div class="message" id="message">ğŸ„ Benvenuta!</div>
<button class="action" id="actionBtn" disabled>ğŸ² TIRA IL DADO</button>

</div>

<!-- INTRO -->
<div class="modal" id="introModal">
  <div class="box">
    <h2>ğŸ„ Christmas Garden Race</h2>
    <p>
      ğŸ° TU vs ğŸ… Babbo Natale<br><br>
      ğŸ² Tira il dado e avanza nel giardino<br>
      âš« Buco nero â†’ torni allo START<br>
      ğŸ Regalo â†’ scegli âˆ’1 o +2<br>
      â„ï¸ Ghiaccio â†’ salti un turno<br><br>
      ğŸ¥• Arriva alla carota per vincere!
    </p>
    <button onclick="startGame()">â–¶ï¸ AVVIA</button>
  </div>
</div>

<!-- REGALO -->
<div class="modal" id="giftModal">
  <div class="box">
    <h3>ğŸ Regalo!</h3>
    <p>Scegli cosa fare:</p>
    <button onclick="giftChoice(-1)">â– âˆ’1</button>
    <button onclick="giftChoice(2)">â• +2</button>
  </div>
</div>

<script>
/* ===== ELEMENTI ===== */
const board = document.getElementById("board");
const msg = document.getElementById("message");
const btn = document.getElementById("actionBtn");
const turnoEl = document.getElementById("turno");
const dadoEl = document.getElementById("dado");

/* ===== STATO ===== */
let gameStarted = false;
let currentPlayer = 1;
let dado = 0;

const players = {
  1: { pos: 0, icon: "ğŸ°", skip: false },
  2: { pos: 0, icon: "ğŸ…", skip: false }
};

/* ===== CASELLE SPECIALI ===== */
let blackHoles = [8,13,19];
const gifts = [6,18];
const ice = [12,25];

/* ===== CREA GRIGLIA ===== */
for(let i=30;i>=0;i--){
  const c=document.createElement("div");
  c.className="cell";
  c.dataset.num=i;

  if(i===0){ c.classList.add("start"); c.textContent="START"; }
  else if(i===30){ c.classList.add("finish"); c.textContent="ğŸ¥•"; }
  else c.textContent=i;

  board.appendChild(c);
}

/* ===== RENDER ===== */
function render(){
  document.querySelectorAll(".players").forEach(p=>p.remove());
  document.querySelectorAll(".cell").forEach(c=>{
    c.classList.remove("black","gift","ice");
    const n=+c.dataset.num;
    if(blackHoles.includes(n)) c.classList.add("black");
    if(gifts.includes(n)) c.classList.add("gift");
    if(ice.includes(n)) c.classList.add("ice");
  });

  for(let i=0;i<=30;i++){
    const cell=document.querySelector(`.cell[data-num="${i}"]`);
    const here=Object.values(players).filter(p=>p.pos===i);
    if(here.length){
      const box=document.createElement("div");
      box.className="players";
      here.forEach(p=>{
        const s=document.createElement("span");
        s.textContent=p.icon;
        box.appendChild(s);
      });
      cell.appendChild(box);
    }
  }
}

/* ===== AVVIO ===== */
function startGame(){
  document.getElementById("introModal").style.display="none";
  gameStarted=true;
  msg.textContent="ğŸ¯ Tira il dado";
  btn.disabled=false;
}

/* ===== EFFETTO DADO ===== */
function rollDice(){
  let count=0;
  btn.disabled=true;
  dadoEl.classList.add("dice-rolling");

  const rolling=setInterval(()=>{
    const fake=Math.floor(Math.random()*6)+1;
    dadoEl.textContent="ğŸ² "+fake;
    count++;
  },100);

  setTimeout(()=>{
    clearInterval(rolling);
    dado=Math.floor(Math.random()*6)+1;
    dadoEl.textContent="ğŸ² "+dado;
    dadoEl.classList.remove("dice-rolling");

    if(dado===6){
      randomizeBlackHoles();
      msg.textContent="ğŸ² 6! I buchi neri si spostano!";
    }

    btn.disabled=false;
  },700);
}

function randomizeBlackHoles(){
  blackHoles=[];
  while(blackHoles.length<3){
    const r=Math.floor(Math.random()*28)+1;
    if(!blackHoles.includes(r)) blackHoles.push(r);
  }
}

function checkBlackHole(p){
  if(blackHoles.includes(players[p].pos)){
    players[p].pos=0;
    msg.textContent="âš« Buco nero! Torni allo START";
    return true;
  }
  return false;
}

function checkGift(p){
  if(gifts.includes(players[p].pos)){
    document.getElementById("giftModal").style.display="flex";
    return true;
  }
  return false;
}

function giftChoice(v){
  document.getElementById("giftModal").style.display="none";
  players[currentPlayer].pos=Math.max(0,Math.min(30,players[currentPlayer].pos+v));
  msg.textContent=v>0?"ğŸ Avanzi di 2":"ğŸ Torni indietro di 1";
  render();
  nextTurn();
}

function checkIce(p){
  if(ice.includes(players[p].pos)){
    players[p].skip=true;
    msg.textContent="â„ï¸ Ghiaccio! Salti il turno";
  }
}

/* ===== TURNO TU ===== */
btn.onclick=()=>{
  if(!gameStarted || currentPlayer!==1) return;

  if(players[1].skip){
    players[1].skip=false;
    msg.textContent="â­ Turno saltato";
    nextTurn();
    return;
  }

  rollDice();
  setTimeout(()=>{
    players[1].pos=Math.min(30,players[1].pos+dado);
    render();

    setTimeout(()=>{
      if(checkBlackHole(1)){render();nextTurn();return;}
      if(checkGift(1)) return;
      checkIce(1);
      render();
      nextTurn();
    },400);
  },750);
};

/* ===== TURNO PC ===== */
function pcTurn(){
  turnoEl.textContent="Turno: PC ğŸ…";
  btn.disabled=true;

  setTimeout(()=>{
    if(players[2].skip){
      players[2].skip=false;
      msg.textContent="ğŸ… PC salta il turno";
      nextTurn();
      return;
    }

    rollDice();
    setTimeout(()=>{
      players[2].pos=Math.min(30,players[2].pos+dado);
      render();

      setTimeout(()=>{
        if(checkBlackHole(2)){render();nextTurn();return;}
        if(checkGift(2)){
          giftChoice(Math.random()<0.5?-1:2);
          return;
        }
        checkIce(2);
        render();
        nextTurn();
      },400);
    },750);
  },600);
}

/* ===== CAMBIO TURNO ===== */
function nextTurn(){
  if(players[currentPlayer].pos>=30){
    msg.textContent=currentPlayer===1
      ?"ğŸ¥• HAI PRESO LA CAROTA! BUON NATALE!"
      :"ğŸ… BABBO NATALE HA PRESO LA CAROTA!";
    btn.disabled=true;
    return;
  }

  currentPlayer=currentPlayer===1?2:1;
  dadoEl.textContent="ğŸ² â€”";

  if(currentPlayer===1){
    turnoEl.textContent="Turno: TU ğŸ°";
    msg.textContent="ğŸ¯ Tira il dado";
    btn.disabled=false;
  }else{
    msg.textContent="ğŸ… Turno del PCâ€¦";
    pcTurn();
  }
}

/* ===== START ===== */
document.getElementById("introModal").style.display="flex";
render();
</script>

</body>
</html>