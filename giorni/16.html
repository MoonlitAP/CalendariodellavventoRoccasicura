<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üê∞ Carrera de Conejos - Wood Edition</title>
<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-color: #a8d5ba;
    --wood-border: #d2a679;
    --board-green: #5eb061;
    --player-color: #ff4081;
    --cpu-color: #7e57c2;
  }

  body { 
    margin: 0; font-family: 'Ubuntu', sans-serif; background: var(--bg-color); 
    display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh;
  }

  /* Schermate di Overlay */
  .overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.4); backdrop-filter: blur(5px);
    display: flex; align-items: center; justify-content: center; z-index: 100;
  }
  .modal {
    background: #fffdf5; padding: 30px; border-radius: 30px; border: 6px solid var(--wood-border);
    max-width: 350px; text-align: center; box-shadow: 0 15px 30px rgba(0,0,0,0.2);
  }
  .hidden { display: none !important; }

  /* Tabellone in legno */
  #board-container {
    position: relative; padding: 20px; background: var(--wood-border);
    border-radius: 50%; box-shadow: inset 0 -10px 0 rgba(0,0,0,0.2), 0 10px 30px rgba(0,0,0,0.3);
  }

  #board {
    width: 440px; height: 440px; background: var(--board-green);
    border-radius: 50%; position: relative; border: 4px solid #4a8c4d;
  }

  /* Caselle stile "tessera di legno" */
  .cell { 
    width: 36px; height: 36px; background: #f3e5ab; border-radius: 8px; position: absolute; 
    display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; color: #8d6e63; 
    box-shadow: 0 4px 0 #d7ccc8, 0 6px 10px rgba(0,0,0,0.1); transition: all 0.3s ease;
  }
  .hole { background: #1a1a1a !important; box-shadow: inset 0 4px 10px #000; border: none; }

  #carrot-center { 
    width: 70px; height: 70px; background: #ffa726; border-radius: 50%; position: absolute; 
    top: 185px; left: 185px; display: flex; align-items: center; justify-content: center;
    font-size: 35px; box-shadow: 0 6px 0 #ef6c00, 0 8px 15px rgba(0,0,0,0.2); z-index: 5;
  }

  /* Conigli */
  .rabbit { 
    width: 32px; height: 32px; border-radius: 50%; position: absolute; z-index: 10; border: 3px solid white; 
    transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: pointer;
    box-shadow: 0 5px 10px rgba(0,0,0,0.3);
  }
  .player { background: var(--player-color); }
  .cpu { background: var(--cpu-color); }
  .can-move { animation: bounce 0.6s infinite alternate; box-shadow: 0 0 20px #fff; }

  @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-10px); } }

  /* UI */
  #info-panel {
    margin-top: 20px; background: #fffdf5; padding: 15px 40px; border-radius: 20px;
    border: 3px solid var(--wood-border); font-size: 20px; font-weight: bold; color: #5d4037;
  }

  #dice-btn {
    margin-top: 20px; padding: 15px 40px; border: none; border-radius: 40px;
    background: #ff9800; color: white; font-size: 22px; font-weight: bold;
    box-shadow: 0 6px 0 #e65100; cursor: pointer; transition: 0.1s;
  }
  #dice-btn:active { transform: translateY(4px); box-shadow: 0 2px #e65100; }
  #dice-btn:disabled { background: #bcaaa4; box-shadow: 0 6px 0 #8d6e63; opacity: 0.7; }

  /* Basi di partenza */
  .base { position: absolute; background: rgba(255,255,255,0.2); border-radius: 15px; padding: 5px; display: flex; flex-direction: column; gap: 5px; }
  .base-player { left: -60px; top: 280px; }
  .base-cpu { right: -60px; top: 100px; }
</style>
</head>
<body>

<div id="startOverlay" class="overlay">
  <div class="modal">
    <h2 style="color:#5eb061">üê∞ Wood Carrera</h2>
    <p>Porta i tuoi coniglietti alla carota centrale!</p>
    <ul style="text-align:left; font-size: 14px; color: #5d4037;">
      <li>Tira il dado e scegli quale coniglio muovere.</li>
      <li>Con il <b>6</b> i buchi neri si spostano!</li>
      <li>Evita i buchi o tornerai alla base.</li>
    </ul>
    <button id="dice-btn" onclick="startGame()">GIOCA ORA</button>
  </div>
</div>

<div id="endOverlay" class="overlay hidden">
  <div class="modal">
    <h1 id="winner-text">üèÜ VITTORIA!</h1>
    <button id="dice-btn" onclick="location.reload()">RIPROVA</button>
  </div>
</div>

<h1 style="color: #2e7d32; margin-bottom: 0;">üê∞ Carrera de Conejos</h1>

<div id="board-container">
  <div class="base base-player" id="p-base"></div>
  <div class="base base-cpu" id="c-base"></div>
  <div id="board">
    <div id="carrot-center">ü•ï</div>
  </div>
</div>

<div id="info-panel">Tira il dado!</div>
<button id="dice-btn" onclick="rollDice()">üé≤ TIRA IL DADO</button>

<script>
const board = document.getElementById("board");
const info = document.getElementById("info-panel");
const diceBtn = document.getElementById("dice-btn");

let turn = "player";
let currentDice = 0;
let gameState = "waiting"; 
const path = [];
let holes = [5, 12, 20];

function startGame() { document.getElementById("startOverlay").classList.add("hidden"); }

// Creazione percorso a spirale leggibile
function createPath() {
  const totalSteps = 28;
  const centerX = 220, centerY = 220;
  for (let i = 0; i < totalSteps; i++) {
    const angle = 0.7 * i;
    const r = 185 - (i * 6); 
    const x = centerX + r * Math.cos(angle) - 18;
    const y = centerY + r * Math.sin(angle) - 18;
    path.push({ x, y });
  }
}
createPath();

function renderCells() {
  document.querySelectorAll('.cell').forEach(c => c.remove());
  path.forEach((p, i) => {
    const cellNum = i + 1;
    const c = document.createElement("div");
    c.className = "cell" + (holes.includes(cellNum) ? " hole" : "");
    c.style.left = p.x + "px"; c.style.top = p.y + "px";
    if (!holes.includes(cellNum)) c.textContent = cellNum;
    board.appendChild(c);
  });
}
renderCells();

function moveHoles() {
  let newHoles = [];
  while(newHoles.length < 3) {
    let r = Math.floor(Math.random() * 20) + 4;
    if(!newHoles.includes(r)) newHoles.push(r);
  }
  holes = newHoles;
  renderCells();
}

let rabbits = [];
function initRabbits() {
  for (let i = 0; i < 6; i++) { // 3 per parte per non affollare
    const isPlayer = i < 3;
    const r = document.createElement("div");
    r.className = "rabbit " + (isPlayer ? "player" : "cpu");
    r.pos = -1; r.id = i; r.dataset.type = isPlayer ? "player" : "cpu";
    r.onclick = () => handleRabbitClick(r);
    board.appendChild(r);
    rabbits.push(r);
    updatePosition(r);
  }
}

function updatePosition(r) {
  if (r.pos === -1) {
    // Posizionamento nelle basi laterali
    const base = r.dataset.type === "player" ? document.getElementById("p-base") : document.getElementById("c-base");
    r.style.position = "static";
    r.style.margin = "5px";
    base.appendChild(r);
  } else {
    r.style.position = "absolute";
    r.style.left = path[r.pos].x + 2 + "px";
    r.style.top = path[r.pos].y + 2 + "px";
    board.appendChild(r);
  }
}
initRabbits();

function rollDice() {
  currentDice = Math.floor(Math.random() * 6) + 1;
  diceBtn.disabled = true;
  info.innerHTML = `üé≤ Risultato: <b>${currentDice}</b>`;
  
  if (currentDice === 6) {
    moveHoles();
    setTimeout(startSelection, 800);
  } else {
    startSelection();
  }
}

function startSelection() {
  if (turn === "player") {
    gameState = "selecting";
    rabbits.filter(r => r.dataset.type === "player").forEach(r => r.classList.add("can-move"));
    info.innerHTML += " - Muovi un coniglio!";
  } else {
    setTimeout(cpuLogic, 800);
  }
}

function handleRabbitClick(r) {
  if (gameState !== "selecting" || r.dataset.type !== "player") return;
  rabbits.forEach(rb => rb.classList.remove("can-move"));
  moveRabbit(r);
}

function moveRabbit(r) {
  gameState = "moving";
  r.pos += currentDice;
  
  if (r.pos >= path.length - 1) {
    r.pos = path.length - 1;
    updatePosition(r);
    setTimeout(() => {
      document.getElementById("endOverlay").classList.remove("hidden");
      document.getElementById("winner-text").innerText = turn === "player" ? "üèÜ HAI VINTO!" : "ü§ñ CPU VINCE";
    }, 500);
    return;
  }
  
  updatePosition(r);
  
  if (holes.includes(r.pos + 1)) {
    setTimeout(() => {
      r.pos = -1;
      updatePosition(r);
      info.innerHTML = "üåÄ <b>CADUTO!</b>";
    }, 600);
  }
  
  setTimeout(nextTurn, 1000);
}

function cpuLogic() {
  let r = rabbits.filter(r => r.dataset.type === "cpu").sort((a,b) => b.pos - a.pos)[0];
  moveRabbit(r);
}

function nextTurn() {
  turn = turn === "player" ? "cpu" : "player";
  gameState = "waiting";
  info.innerHTML = turn === 'player' ? "Tocca a te!" : "Il Computer pensa...";
  diceBtn.disabled = (turn === "cpu");
  if (turn === "cpu") setTimeout(rollDice, 600);
}
</script>
</body>
</html>
