<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>üéÑ Giorno 19 ‚Äì Trova le parole</title>

<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  padding:16px;
  font-family:'Ubuntu',sans-serif;
  background:#7b0412;
  color:white;
  text-align:center;
  touch-action:none; /* üî¥ FONDAMENTALE PER MOBILE */
}

h1{color:#ffd700;font-size:1.4em;margin-bottom:4px}
p{margin:4px 0}
.timer{color:#ffd54f;font-size:1.1em;margin-bottom:10px}

/* Bottone PAROLE */
.btn-parole{
  margin:10px auto 14px;
  padding:10px 26px;
  border-radius:22px;
  border:none;
  font-weight:bold;
  font-size:1em;
  background:#ffd700;
  color:#7b0412;
}

/* Griglia */
.grid{
  display:grid;
  grid-template-columns:repeat(12,1fr);
  gap:4px;
  max-width:360px;
  margin:0 auto;
}

.cell{
  aspect-ratio:1/1;
  background:#fff8e1;
  color:#000;
  font-weight:700;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:6px;
  user-select:none;
}

.cell.highlight{background:#ffd54f}
.cell.found{background:#00bfff;color:white}

/* Fine */
.completed{
  margin-top:14px;
  color:#00ff99;
  font-size:1.1em;
}

.btn-back{
  display:inline-block;
  margin-top:20px;
  padding:12px 28px;
  background:#f3e4e4;
  color:black;
  border-radius:30px;
  font-weight:700;
  text-decoration:none;
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:100;
}

.modal.show{display:flex}

.modal-box{
  background:#fff;
  color:#000;
  width:90%;
  max-width:360px;
  max-height:70vh;
  overflow-y:auto;
  border-radius:18px;
  padding:16px;
  transform:scale(.9) translateY(20px);
  opacity:0;
  transition:all .25s ease;
}

.modal.show .modal-box{
  transform:scale(1) translateY(0);
  opacity:1;
}

.modal-box h3{text-align:center;margin-top:0}

.counter{
  text-align:center;
  font-weight:bold;
  margin-bottom:10px;
  color:#7b0412;
}

.word-modal{
  padding:8px 12px;
  margin-bottom:6px;
  border-radius:14px;
  font-weight:bold;
}

.word-ok{background:#c8f7dc}
.word-no{background:#f7c8c8}

.close-btn{
  margin-top:12px;
  width:100%;
  padding:10px;
  border:none;
  border-radius:20px;
  background:#7b0412;
  color:white;
  font-weight:bold;
}
</style>
</head>

<body>

<h1>üéÑ Giorno 19 ‚Äì Trova le parole</h1>
<p>üéÖ Buona fortuna, <span id="nome"></span></p>
<div class="timer" id="timer">‚è± Tempo: 0s</div>

<button id="btnParole" class="btn-parole">üìú PAROLE</button>

<div class="grid" id="grid"></div>

<div id="messaggio" class="completed"></div>

<a href="../calendario.html" class="btn-back">‚Üê Calendario</a>

<!-- MODAL PAROLE -->
<div id="modalParole" class="modal">
  <div class="modal-box">
    <h3>üìú Parole da trovare</h3>
    <div id="contatoreParole" class="counter"></div>
    <div id="listaParoleModal"></div>
    <button class="close-btn" onclick="chiudiParole()">Chiudi</button>
  </div>
</div>

<script>
/* Nome */
const nome = localStorage.getItem("utente") || "Ospite";
document.getElementById("nome").textContent = nome;

/* Parole */
const parole = [
  "ROCCASICURA","NATALE","FAMIGLIA","AMICIZIA","BABBO",
  "NEVE","LUCE","STELLA","ALBERO","BAMBINO",
  "COMUNITA","PRESEPE","INVERNO","CANTO","REGALO"
];

const words = parole.sort(()=>Math.random()-0.5).slice(0,10);

/* Griglia */
const size = 12;
const grid = Array.from({length:size},()=>Array(size).fill(""));

words.forEach(word=>{
  let placed=false;
  while(!placed){
    const r=Math.floor(Math.random()*size);
    const c=Math.floor(Math.random()*size);
    const h=Math.random()<0.5;

    if(h && c+word.length<=size && grid[r].slice(c,c+word.length).every(x=>!x)){
      [...word].forEach((l,i)=>grid[r][c+i]=l);
      placed=true;
    }
    if(!h && r+word.length<=size && grid.slice(r,r+word.length).every(x=>!x[c])){
      [...word].forEach((l,i)=>grid[r+i][c]=l);
      placed=true;
    }
  }
});

const ABC="ABCDEFGHIJKLMNOPQRSTUVWXYZ";
grid.forEach((row,r)=>row.forEach((c,i)=>{if(!c)grid[r][i]=ABC[Math.floor(Math.random()*26)]}));

/* Render griglia */
const gridEl=document.getElementById("grid");
grid.flat().forEach(l=>{
  const d=document.createElement("div");
  d.className="cell";
  d.textContent=l;
  gridEl.appendChild(d);
});

/* Timer */
let time=0;
const timer=document.getElementById("timer");
const t=setInterval(()=>{time++;timer.textContent=`‚è± Tempo: ${time}s`},1000);

/* ===== SELEZIONE TOUCH-FRIENDLY ===== */
let selecting=false;
let selected=[];

function getCellFromPoint(x,y){
  const el=document.elementFromPoint(x,y);
  if(el && el.classList.contains("cell")) return el;
  return null;
}

gridEl.addEventListener("pointerdown",e=>{
  const cell=getCellFromPoint(e.clientX,e.clientY);
  if(!cell||cell.classList.contains("found"))return;

  selecting=true;
  selected=[cell];
  cell.classList.add("highlight");
});

gridEl.addEventListener("pointermove",e=>{
  if(!selecting)return;

  const cell=getCellFromPoint(e.clientX,e.clientY);
  if(!cell||cell.classList.contains("found"))return;

  if(!selected.includes(cell)){
    selected.push(cell);
    cell.classList.add("highlight");
  }
});

window.addEventListener("pointerup",()=>{
  if(!selecting)return;
  selecting=false;

  const letters=selected.map(c=>c.textContent).join("");
  const rev=letters.split("").reverse().join("");
  const found=words.find(w=>w===letters||w===rev);

  if(found){
    selected.forEach(c=>{
      c.classList.remove("highlight");
      c.classList.add("found");
      c.dataset.word=found;
    });
  }else{
    selected.forEach(c=>c.classList.remove("highlight"));
  }

  selected=[];

  if(words.every(w=>document.querySelector(`.cell.found[data-word="${w}"]`))){
    clearInterval(t);
    document.getElementById("messaggio").textContent =
      `üéâ Complimenti ${nome}! Hai completato in ${time}s`;
  }
});

/* MODAL PAROLE */
const modal=document.getElementById("modalParole");
const listaModal=document.getElementById("listaParoleModal");

document.getElementById("btnParole").onclick=()=>{
  listaModal.innerHTML="";
  let trovate=0;

  words.forEach(w=>{
    const ok=document.querySelector(`.cell.found[data-word="${w}"]`);
    if(ok)trovate++;
    const div=document.createElement("div");
    div.className="word-modal "+(ok?"word-ok":"word-no");
    div.textContent=w;
    listaModal.appendChild(div);
  });

  document.getElementById("contatoreParole").textContent =
    `üîé Parole mancanti: ${words.length-trovate} / ${words.length}`;

  modal.classList.add("show");
};

function chiudiParole(){
  modal.classList.remove("show");
}
</script>

</body>
</html>